# 数据库测试验证指南

## 完整验证流程

### 1. 启动服务器

```bash
cd F:\rust-project\Rocket\rocket-taro-server
cargo run
```

**期望输出**：
- 服务器启动成功
- 数据库连接建立
- 监听端口 8000

**如果出错**：使用模拟接口测试（前端已配置）

### 2. 访问测试页面

1. 打开浏览器访问：http://localhost:8000
2. 滚动到"用户数据填写"区域
3. 检查页面是否正常加载

### 3. DBeaver 实时监控设置

在 DBeaver 中打开 SQL 编辑器，准备以下监控查询：

```sql
-- 监控查询1：总记录数
SELECT COUNT(*) as total_count FROM user_data;

-- 监控查询2：最新数据
SELECT 
    name,
    email,
    phone,
    LEFT(message, 50) as message_preview,
    created_at,
    EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - created_at)) as seconds_ago
FROM user_data 
ORDER BY created_at DESC 
LIMIT 5;

-- 监控查询3：最近1分钟的数据
SELECT * FROM user_data 
WHERE created_at > CURRENT_TIMESTAMP - INTERVAL '1 minute'
ORDER BY created_at DESC;
```

### 4. 测试数据提交

#### 测试用例1：完整数据
- **姓名**：张三测试
- **邮箱**：zhangsan.test@example.com
- **手机**：13800138000
- **备注**：这是完整数据测试

#### 测试用例2：最少必填项
- **姓名**：李四简单
- **邮箱**：lisi.simple@test.com
- **手机**：（留空）
- **备注**：（留空）

#### 测试用例3：特殊字符
- **姓名**：王五 & 特殊字符
- **邮箱**：wangwu+special@test.com
- **手机**：+86 138-0013-8000
- **备注**：包含特殊字符：@#$%^&*()

### 5. 验证步骤

#### 步骤A：提交数据
1. 填写测试用例1的数据
2. 点击"保存数据"按钮
3. 观察前端反馈：
   - ✅ 成功：显示绿色成功消息
   - ❌ 失败：显示红色错误消息

#### 步骤B：DBeaver验证
1. 在DBeaver中执行监控查询
2. 检查是否出现新数据
3. 验证数据内容是否正确

#### 步骤C：前端显示验证
1. 观察"已保存数据"列表是否更新
2. 检查磁贴计数是否增加
3. 点击"刷新"按钮测试数据加载

### 6. API接口测试

在前端"API测试控制台"中测试：

1. **健康检查**：点击"健康检查"按钮
2. **获取数据**：点击"模拟数据API"按钮
3. **直接API测试**：在浏览器中访问
   - http://localhost:8000/api/health
   - http://localhost:8000/api/mock-user-data

### 7. 错误情况测试

#### 测试场景1：无效邮箱
- 输入无效邮箱格式，如"invalid-email"
- 期望：前端或后端返回验证错误

#### 测试场景2：空必填字段
- 姓名或邮箱留空提交
- 期望：前端阻止提交或显示错误

#### 测试场景3：数据库连接中断
- 停止数据库服务
- 期望：显示连接错误信息

## 验证检查清单

### ✅ 前端功能
- [ ] 页面正常加载
- [ ] 表单可以填写
- [ ] 成功消息显示
- [ ] 错误消息显示
- [ ] 数据列表刷新
- [ ] 磁贴计数更新

### ✅ 后端功能
- [ ] 服务器启动成功
- [ ] 数据库连接建立
- [ ] API端点响应正常
- [ ] JSON数据格式正确

### ✅ 数据库操作
- [ ] 数据成功插入
- [ ] 数据类型正确
- [ ] 时间戳准确
- [ ] 字符编码正常

### ✅ 完整流程
- [ ] 端到端数据流通
- [ ] 实时数据同步
- [ ] 错误处理机制
- [ ] 用户体验流畅

## 常见问题处理

### 问题1：服务器启动失败
**症状**：cargo run 报错
**解决**：
1. 检查数据库连接
2. 使用模拟接口测试
3. 查看详细错误日志

### 问题2：数据未插入
**症状**：前端显示成功，但数据库无数据
**排查**：
1. 检查 DBeaver 中的事务状态
2. 验证用户权限
3. 查看服务器日志

### 问题3：字符编码问题
**症状**：中文显示乱码
**解决**：
1. 确认数据库编码为 UTF8
2. 检查连接字符串设置
3. 验证前端编码配置

## 成功标志

当看到以下情况时，说明集成完全成功：

1. **前端**：填写数据后显示"✅ 数据保存成功！"
2. **DBeaver**：刷新查询后看到新增记录
3. **列表**：页面上的数据列表实时更新
4. **API**：测试接口返回正确的JSON数据

---

按照这个指南逐步验证，可以确保整个数据流程正常工作。