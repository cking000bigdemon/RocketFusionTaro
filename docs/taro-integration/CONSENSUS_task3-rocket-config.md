# 任务3: Rocket配置更新 - 需求共识文档

## 最终需求描述
基于Rocket框架和已初始化的Taro前端项目，完成以下配置更新：

### 核心需求 ✅
1. **创建Rocket主服务** - 创建 `src/main.rs` 作为服务入口
2. **配置静态文件服务** - 服务Taro构建产物
3. **配置CORS支持** - 支持前端跨域请求
4. **配置API路由** - 支持RESTful API
5. **集成前后端** - 实现前后端无缝对接

### 技术实现方案

#### 1. 服务架构
```
Rocket Server
├── 静态文件服务 (/ → frontend/dist/)
├── API路由 (/api/*)
├── CORS中间件
└── 健康检查端点
```

#### 2. 目录结构
```
rocket-taro-integration/
├── src/
│   ├── main.rs           # Rocket服务入口
│   ├── routes/
│   │   ├── mod.rs        # 路由模块
│   │   └── api.rs        # API路由
│   ├── fairings/
│   │   └── cors.rs       # CORS配置
│   └── models/
│       └── response.rs   # API响应模型
├── Cargo.toml           # 添加必要依赖
├── Rocket.toml          # 环境配置
└── frontend/            # 已创建的Taro项目
```

#### 3. 技术约束
- **Rust版本**: 与Rocket项目兼容的稳定版本
- **依赖管理**: 使用标准Cargo.toml
- **静态目录**: `frontend/dist/` 作为构建产物目录
- **API前缀**: 所有API路由使用 `/api/` 前缀
- **端口配置**: 开发环境使用8000端口

#### 4. 集成方案
- **开发模式**: Taro dev server + Rocket API server
- **生产模式**: Rocket服务静态文件 + API路由
- **构建流程**: 前端构建 → 后端集成 → 统一部署

### 验收标准

#### 功能验收
- [ ] Rocket服务能正常启动
- [ ] 静态文件服务正常工作
- [ ] CORS配置允许前端跨域请求
- [ ] API路由响应正确
- [ ] 健康检查端点可访问

#### 集成验收
- [ ] 前端能正常访问后端API
- [ ] 开发环境前后端协同工作
- [ ] 生产构建产物能被正确服务
- [ ] 路由回退机制正常工作（SPA支持）

#### 质量验收
- [ ] 代码符合Rust编码规范
- [ ] 配置清晰可维护
- [ ] 文档完整准确
- [ ] 无安全漏洞

### 边界确认
- **任务范围**: 仅Rocket配置更新，不涉及业务逻辑
- **不包含**: 数据库集成、认证授权、复杂业务API
- **保持兼容**: 与现有Rocket examples兼容
- **可扩展**: 为未来功能扩展预留接口

### 关键假设确认
基于项目分析，确认以下假设：

1. **服务入口**: 创建新的 `src/main.rs` 作为Rocket服务入口
2. **静态目录**: 使用 `frontend/dist/` 作为静态文件目录
3. **API前缀**: 使用 `/api/` 作为所有API路由前缀
4. **CORS策略**: 开发环境允许所有来源，生产环境可配置
5. **端口**: 使用Rocket默认端口8000
6. **构建流程**: 前端构建后产物自动部署到Rocket静态目录

### 风险识别
- **依赖冲突**: 确保新依赖与现有项目兼容
- **路径问题**: 静态文件路径配置正确性
- **CORS安全**: 生产环境CORS配置需要谨慎
- **构建集成**: 前后端构建流程协调

### 下一步操作
所有关键决策已确认，可以进入架构设计阶段。