# AI知识库 WebView 配置指南

## 问题描述
WebView 加载 `https://halo.lxc.cksiyouyun.icu:22000/` 失败

## 常见原因及解决方案

### 1. 域名未配置（最常见）
**症状**：提示"不支持打开非业务域名"

**解决步骤**：
1. 登录 [微信公众平台](https://mp.weixin.qq.com)
2. 进入"开发" → "开发管理" → "业务域名"
3. 添加域名 `halo.lxc.cksiyouyun.icu`
4. 下载校验文件并上传到服务器根目录
5. 点击"保存"完成配置

**注意事项**：
- 域名必须已备案（国内服务器）
- 必须使用 HTTPS 协议
- 每月可修改业务域名 50 次

### 2. HTTPS 证书问题
**症状**：SSL 证书验证失败

**解决方案**：
- 确保使用有效的 SSL 证书（不能是自签名证书）
- 检查证书链是否完整
- 证书域名必须与访问域名匹配

**推荐**：
- 使用 Let's Encrypt 免费证书
- 或使用云服务商提供的免费 SSL 证书

### 3. 服务器配置问题
**检查项**：
- 服务器是否可公网访问
- 端口 22000 是否开放
- 防火墙/安全组是否允许访问

**测试方法**：
```bash
# 在浏览器中直接访问
https://halo.lxc.cksiyouyun.icu:22000/

# 使用 curl 测试
curl -I https://halo.lxc.cksiyouyun.icu:22000/
```

### 4. 开发环境临时解决方案

#### 方案一：使用公开可访问的测试地址
修改 `utils/config.js`：
```javascript
aiKnowledge: {
  webviewUrl: 'https://www.baidu.com'  // 临时测试地址
}
```

#### 方案二：使用真机调试
1. 在微信开发者工具中点击"真机调试"
2. 扫码在手机上测试
3. 真机调试时可以忽略域名校验

#### 方案三：开发者工具设置
1. 在微信开发者工具中
2. 点击"详情" → "本地设置"
3. 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
4. **注意**：此设置仅在开发环境有效，正式版必须配置域名

## 正式发布前必须完成
1. ✅ 在微信公众平台配置业务域名
2. ✅ 确保服务器使用有效的 HTTPS 证书
3. ✅ 完成域名备案（如使用国内服务器）
4. ✅ 测试真机环境下的访问

## 配置文件位置
- 配置文件：`frontend-new/mobile/mini-program/utils/config.js`
- AI知识库页面：`frontend-new/mobile/mini-program/pages/ai-knowledge/`

## 错误排查流程
1. 查看控制台错误信息
2. 检查域名是否在小程序后台配置
3. 验证 HTTPS 证书是否有效
4. 确认服务器是否可访问
5. 检查网络和防火墙设置

## 联系支持
如问题持续，请提供：
- 完整的错误信息
- 小程序 AppID
- 服务器配置信息
- 域名备案情况