"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[539],{649:function(e,n,r){var t=r(23),a=r(688),s=r(861),o=r(942),c=r(413),i=r(152),u=r(515),l=r(294),d=r(270),h=r(954),p=r.n(h),m=function(){return"http://localhost:8000"},f=function(){var e=(0,s.Z)((0,a.Z)().m(function e(n){var r,t,s,o,i,u,l,d,h=arguments;return(0,a.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:return r=h.length>1&&void 0!==h[1]?h[1]:{},t=m(),s="".concat(t).concat(n),o=p().getStorageSync("session_token"),i=(0,c.Z)({url:s,method:r.method||"GET",data:r.data,header:(0,c.Z)((0,c.Z)({"Content-Type":"application/json"},o?{Authorization:"Bearer ".concat(o)}:{}),r.header)},r),console.log("\ud83d\ude80 \u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42:",{url:s,method:i.method,data:i.data,headers:i.header}),p().showModal({title:"\u7f51\u7edc\u8bf7\u6c42\u8c03\u8bd5",content:"URL: ".concat(s,"\n\u65b9\u6cd5: ").concat(i.method),showCancel:!1}),e.p=1,e.n=2,p().request(i);case 2:if(u=e.v,console.log("\ud83d\udce8 \u7f51\u7edc\u54cd\u5e94:",{url:s,statusCode:u.statusCode,data:u.data,header:u.header}),200!==u.statusCode){e.n=3;break}return e.a(2,u.data);case 3:throw l="\u8bf7\u6c42\u5931\u8d25 - \u72b6\u6001\u7801: ".concat(u.statusCode,", URL: ").concat(s),console.error("\u274c HTTP\u9519\u8bef:",{statusCode:u.statusCode,url:s,response:u.data}),new Error(l);case 4:e.n=7;break;case 5:if(e.p=5,d=e.v,!d.errMsg){e.n=6;break}throw console.error("\u274c \u7f51\u7edc\u8fde\u63a5\u9519\u8bef:",{url:s,errMsg:d.errMsg,errno:d.errno}),p().showModal({title:"\u7f51\u7edc\u9519\u8bef\u8c03\u8bd5",content:"URL: ".concat(s,"\n\u9519\u8bef: ").concat(d.errMsg),showCancel:!1}),new Error("\u7f51\u7edc\u8fde\u63a5\u5931\u8d25: ".concat(d.errMsg));case 6:throw console.error("\u274c \u8bf7\u6c42\u5904\u7406\u9519\u8bef:",d),d;case 7:return e.a(2)}},e,null,[[1,5]])}));return function(n){return e.apply(this,arguments)}}(),g=(0,d.Ue)(function(e,n){return{user:null,loading:!1,userList:[],fetchUser:function(){var n=(0,s.Z)((0,a.Z)().m(function n(){var r,t;return(0,a.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:return e({loading:!0}),n.p=1,n.n=2,f("/api/user");case 2:r=n.v,e({user:r.data,loading:!1}),n.n=4;break;case 3:n.p=3,t=n.v,console.error("Failed to fetch user:",t),e({loading:!1}),p().showToast({title:"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25",icon:"error"});case 4:return n.a(2)}},n,null,[[1,3]])}));function r(){return n.apply(this,arguments)}return r}(),fetchUserData:function(){var n=(0,s.Z)((0,a.Z)().m(function n(){var r,t;return(0,a.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:return e({loading:!0}),n.p=1,n.n=2,f("/api/user-data");case 2:r=n.v,e({userList:r.data||[],loading:!1}),n.n=4;break;case 3:n.p=3,t=n.v,console.error("Failed to fetch user data:",t),e({loading:!1}),p().showToast({title:"\u83b7\u53d6\u6570\u636e\u5931\u8d25",icon:"error"});case 4:return n.a(2)}},n,null,[[1,3]])}));function r(){return n.apply(this,arguments)}return r}(),createUserData:function(){var r=(0,s.Z)((0,a.Z)().m(function r(t){var s,o;return(0,a.Z)().w(function(r){while(1)switch(r.p=r.n){case 0:return e({loading:!0}),r.p=1,r.n=2,f("/api/user-data",{method:"POST",data:t});case 2:if(s=r.v,200!==s.code){r.n=3;break}return n().fetchUserData(),p().showToast({title:"\u521b\u5efa\u6210\u529f",icon:"success"}),r.a(2,s.data);case 3:throw new Error(s.message||"\u521b\u5efa\u5931\u8d25");case 4:r.n=6;break;case 5:throw r.p=5,o=r.v,console.error("Failed to create user data:",o),e({loading:!1}),p().showToast({title:o.message||"\u521b\u5efa\u5931\u8d25",icon:"error"}),o;case 6:return r.a(2)}},r,null,[[1,5]])}));function t(e){return r.apply(this,arguments)}return t}(),login:function(){var n=(0,s.Z)((0,a.Z)().m(function n(r){var t,s,o,c;return(0,a.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:return console.log("\ud83d\udd10 \u5f00\u59cb\u767b\u5f55\u6d41\u7a0b:",r.username),e({loading:!0}),n.p=1,n.n=2,f("/api/auth/login",{method:"POST",data:r});case 2:if(t=n.v,console.log("\ud83d\udd10 \u767b\u5f55\u54cd\u5e94\u6570\u636e:",t),!t||200!==t.code){n.n=3;break}return t.data&&t.data.session_token&&(console.log("\ud83d\udcbe \u4fdd\u5b58session token"),p().setStorageSync("session_token",t.data.session_token)),e({user:t.data.user,loading:!1}),p().showToast({title:"\u767b\u5f55\u6210\u529f",icon:"success"}),console.log("\u2705 \u767b\u5f55\u6210\u529f"),n.a(2,t.data);case 3:throw s=t&&t.message||"\u767b\u5f55\u5931\u8d25\uff1a\u670d\u52a1\u5668\u8fd4\u56de\u5f02\u5e38\u6570\u636e",console.error("\u274c \u767b\u5f55\u5931\u8d25 - \u54cd\u5e94\u6570\u636e\u5f02\u5e38:",t),new Error(s);case 4:n.n=6;break;case 5:throw n.p=5,c=n.v,console.error("\u274c \u767b\u5f55\u6d41\u7a0b\u5931\u8d25:",{error:c.message,stack:c.stack}),e({loading:!1}),o="\u767b\u5f55\u5931\u8d25",o=c.message.includes("\u7f51\u7edc\u8fde\u63a5\u5931\u8d25")?"\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u8bbe\u7f6e":c.message.includes("\u72b6\u6001\u7801")?"\u670d\u52a1\u5668\u8fde\u63a5\u5f02\u5e38":c.message||"\u672a\u77e5\u9519\u8bef",p().showToast({title:o,icon:"error",duration:3e3}),c;case 6:return n.a(2)}},n,null,[[1,5]])}));function r(e){return n.apply(this,arguments)}return r}(),getCurrentUser:function(){var n=(0,s.Z)((0,a.Z)().m(function n(){var r,t;return(0,a.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:return e({loading:!0}),n.p=1,n.n=2,f("/api/auth/current");case 2:if(r=n.v,200!==r.code){n.n=3;break}return e({user:r.data,loading:!1}),n.a(2,r.data);case 3:throw new Error(r.message||"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25");case 4:n.n=6;break;case 5:throw n.p=5,t=n.v,console.error("Failed to get current user:",t),e({loading:!1}),t.message.includes("401")&&(e({user:null}),p().removeStorageSync("session_token")),p().showToast({title:t.message||"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25",icon:"error"}),t;case 6:return n.a(2)}},n,null,[[1,5]])}));function r(){return n.apply(this,arguments)}return r}(),logout:function(){var n=(0,s.Z)((0,a.Z)().m(function n(){var r;return(0,a.Z)().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,f("/api/auth/logout",{method:"POST"});case 1:e({user:null}),p().removeStorageSync("session_token"),p().showToast({title:"\u5df2\u9000\u51fa\u767b\u5f55",icon:"success"}),n.n=3;break;case 2:n.p=2,r=n.v,console.error("Logout failed:",r),e({user:null}),p().removeStorageSync("session_token");case 3:return n.a(2)}},n,null,[[0,2]])}));function r(){return n.apply(this,arguments)}return r}(),setUser:function(n){return e({user:n})},clearUser:function(){return e({user:null})},setUserList:function(n){return e({userList:n})}}}),w=r(893);function v(){var e=(0,l.useState)(0),n=(0,i.Z)(e,2),r=n[0],t=n[1],d=(0,l.useState)({name:"",email:"",phone:"",message:""}),h=(0,i.Z)(d,2),m=h[0],f=h[1],v=g(),x=v.user,Z=v.userList,k=v.loading,j=v.fetchUser,b=v.fetchUserData,N=v.createUserData,C=v.login,y=v.getCurrentUser;(0,l.useEffect)(function(){b()},[]);var T=function(e,n){f(function(r){return(0,c.Z)((0,c.Z)({},r),{},(0,o.Z)({},e,n))})},U=function(){var e=(0,s.Z)((0,a.Z)().m(function e(){return(0,a.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:if(m.name&&m.email){e.n=1;break}return p().showToast({title:"\u8bf7\u586b\u5199\u5fc5\u8981\u4fe1\u606f",icon:"error"}),e.a(2);case 1:return e.p=1,e.n=2,N(m);case 2:f({name:"",email:"",phone:"",message:""}),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),S=function(){var e=(0,s.Z)((0,a.Z)().m(function e(){return(0,a.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,C({username:"admin",password:"password"});case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}(),I=function(){var e=(0,s.Z)((0,a.Z)().m(function e(){return(0,a.Z)().w(function(e){while(1)switch(e.p=e.n){case 0:return e.p=0,e.n=1,y();case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}();return(0,w.jsxs)(u.G7,{className:"index",children:[(0,w.jsx)(u.xv,{className:"title",children:"Rocket + Taro \u5fae\u4fe1\u5c0f\u7a0b\u5e8f"}),(0,w.jsxs)(u.xv,{className:"subtitle",children:["\u8ba1\u6570\u5668: ",r]}),(0,w.jsx)(u.zx,{className:"button",onClick:function(){return t(r+1)},children:"\u70b9\u51fb\u8ba1\u6570"}),(0,w.jsxs)(u.G7,{className:"section",children:[(0,w.jsx)(u.xv,{className:"section-title",children:"\u7528\u6237\u8ba4\u8bc1\u6d4b\u8bd5"}),(0,w.jsx)(u.zx,{className:"button",onClick:S,loading:k,children:"\u767b\u5f55 (admin/password)"}),(0,w.jsx)(u.zx,{className:"button",onClick:I,loading:k,children:"\u83b7\u53d6\u5f53\u524d\u7528\u6237"}),x&&(0,w.jsxs)(u.G7,{className:"user-info",children:[(0,w.jsxs)(u.xv,{children:["\u7528\u6237: ",x.username]}),(0,w.jsxs)(u.xv,{children:["\u90ae\u7bb1: ",x.email]}),(0,w.jsxs)(u.xv,{children:["\u7ba1\u7406\u5458: ",x.is_admin?"\u662f":"\u5426"]})]})]}),(0,w.jsxs)(u.G7,{className:"section",children:[(0,w.jsx)(u.xv,{className:"section-title",children:"API\u96c6\u6210\u6d4b\u8bd5"}),(0,w.jsx)(u.zx,{className:"button",onClick:j,loading:k,children:"\u83b7\u53d6\u7528\u6237\u4fe1\u606f"}),(0,w.jsx)(u.zx,{className:"button",onClick:b,loading:k,children:"\u83b7\u53d6\u7528\u6237\u6570\u636e\u5217\u8868"})]}),(0,w.jsxs)(u.G7,{className:"section",children:[(0,w.jsxs)(u.xv,{className:"section-title",children:["\u7528\u6237\u6570\u636e\u5217\u8868 (",Z.length,")"]}),Z.map(function(e,n){return(0,w.jsxs)(u.G7,{className:"user-item",children:[(0,w.jsxs)(u.xv,{children:["\u59d3\u540d: ",e.name]}),(0,w.jsxs)(u.xv,{children:["\u90ae\u7bb1: ",e.email]}),e.phone&&(0,w.jsxs)(u.xv,{children:["\u7535\u8bdd: ",e.phone]}),e.message&&(0,w.jsxs)(u.xv,{children:["\u6d88\u606f: ",e.message]})]},e.id||n)})]}),(0,w.jsxs)(u.G7,{className:"section",children:[(0,w.jsx)(u.xv,{className:"section-title",children:"\u521b\u5efa\u7528\u6237\u6570\u636e"}),(0,w.jsx)(u.II,{className:"input",placeholder:"\u8bf7\u8f93\u5165\u59d3\u540d",value:m.name,onInput:function(e){return T("name",e.detail.value)}}),(0,w.jsx)(u.II,{className:"input",placeholder:"\u8bf7\u8f93\u5165\u90ae\u7bb1",value:m.email,onInput:function(e){return T("email",e.detail.value)}}),(0,w.jsx)(u.II,{className:"input",placeholder:"\u8bf7\u8f93\u5165\u7535\u8bdd\uff08\u53ef\u9009\uff09",value:m.phone,onInput:function(e){return T("phone",e.detail.value)}}),(0,w.jsx)(u.II,{className:"input",placeholder:"\u8bf7\u8f93\u5165\u6d88\u606f\uff08\u53ef\u9009\uff09",value:m.message,onInput:function(e){return T("message",e.detail.value)}}),(0,w.jsx)(u.zx,{className:"button primary",onClick:U,loading:k,children:"\u63d0\u4ea4\u6570\u636e"})]})]})}var x={};Page((0,t.createPageConfig)(v,"pages/index/index",{root:{cn:[]}},x||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[216],function(){return n(649)});e.O()}]);