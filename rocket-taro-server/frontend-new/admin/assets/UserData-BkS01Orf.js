import{_ as fe}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                        *//* empty css                   *//* empty css                             *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                */import{l as ye,r as b,h as F,c as ve,d as ge,m as U,t as s,H as t,D as H,B as a,q as E,W as be,F as o,a8 as z,C as he,A as De}from"./vue-vendor-CvPKWCuE.js";import{an as Ce,aq as we,M as m,T as ke,$ as xe,a0 as Ee,ar as ze,as as Be,aA as Ve,V as Se,S as Te,at as Ue,au as Re,W as d,av as Me,ao as Ye,aw as $e,aB as je,aC as Ie,U as Le,ak as Ne,ad as R,az as Oe}from"./element-plus-CWGZaCRY.js";import{b as Fe}from"./index-C1UAl2ua.js";const He={class:"user-data-page"},Je={class:"table-header"},Pe={class:"table-actions"},Ae={class:"user-info"},Ke={class:"username"},qe={class:"user-id"},Ge={class:"data-content"},We={class:"data-preview"},Qe={class:"data-size"},Xe={class:"pagination-wrapper"},Ze={key:0,class:"batch-actions"},et={class:"batch-content"},tt={class:"batch-info"},at={class:"batch-buttons"},lt={key:0,class:"data-detail"},nt={class:"data-json"},ot={class:"detail-actions"},st=ye({__name:"UserData",setup(rt){const{apiClient:J}=Fe(),B=b(!1),V=b(!1),M=b([]),h=b([]),D=b(!1),i=b(null),r=F({username:"",data_type:"",dateRange:null}),c=F({current:1,size:20,total:0}),C=ve(()=>{var l;if(!((l=i.value)!=null&&l.data))return"";try{return JSON.stringify(i.value.data,null,2)}catch{return String(i.value.data)}}),w={user_info:{label:"用户信息",type:"primary"},business_data:{label:"业务数据",type:"success"},system_config:{label:"系统配置",type:"warning"},default:{label:"未知类型",type:"info"}},Y=l=>{var e;return((e=w[l])==null?void 0:e.label)||w.default.label},$=l=>{var e;return((e=w[l])==null?void 0:e.type)||w.default.type},P=l=>{if(!l)return"-";try{const e=typeof l=="string"?l:JSON.stringify(l);return e.length>100?e.substring(0,100)+"...":e}catch{return String(l).substring(0,100)}},A=l=>{if(!l)return"0 B";try{const e=typeof l=="string"?l:JSON.stringify(l),p=new Blob([e]).size;return p<1024?`${p} B`:p<1024*1024?`${(p/1024).toFixed(1)} KB`:`${(p/(1024*1024)).toFixed(1)} MB`}catch{return"未知"}},k=l=>Ne(l).format("YYYY-MM-DD HH:mm:ss"),y=async()=>{B.value=!0;try{const l={page:c.current,size:c.size};r.username&&(l.username=r.username),r.data_type&&(l.data_type=r.data_type),r.dateRange&&(l.start_date=r.dateRange[0],l.end_date=r.dateRange[1]);const e=await J.adminGetUserDataList(l);e.code===200?(M.value=e.data.data||[],c.total=e.data.total||0):m.error(e.message||"获取用户数据失败")}catch(l){console.error("Failed to fetch user data:",l),m.error("获取用户数据失败")}finally{B.value=!1}},S=()=>{c.current=1,y()},K=()=>{Object.assign(r,{username:"",data_type:"",dateRange:null}),S()},q=l=>{c.size=l,y()},G=l=>{c.current=l,y()},W=l=>{h.value=l},j=l=>{i.value=l,D.value=!0},Q=async l=>{try{await R.confirm("确定要删除这条数据记录吗？此操作不可撤销。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.success("数据已删除"),await y()}catch{}},X=async()=>{V.value=!0;try{m.info("数据导出功能开发中...")}catch{m.error("导出失败")}finally{V.value=!1}},Z=async()=>{try{await R.confirm(`确定要导出 ${h.value.length} 条数据记录吗？`,"确认导出",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),m.info("批量导出功能开发中...")}catch{}},ee=async()=>{try{await R.confirm(`确定要删除 ${h.value.length} 条数据记录吗？此操作不可撤销。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.info("批量删除功能开发中...")}catch{}},te=async()=>{try{await navigator.clipboard.writeText(C.value),m.success("内容已复制到剪贴板")}catch{m.error("复制失败，请手动复制")}},ae=()=>{if(!i.value)return;const l=C.value,e=new Blob([l],{type:"application/json"}),p=URL.createObjectURL(e),_=document.createElement("a");_.href=p,_.download=`user_data_${i.value.id}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(p),m.success("下载已开始")};return ge(()=>{y()}),(l,e)=>{const p=Ee,_=xe,x=Be,le=ze,ne=Ve,oe=z("Search"),v=Te,u=Se,I=z("Refresh"),se=ke,T=Ce,L=z("Download"),f=Re,N=Me,re=Ye,ie=Oe,de=$e,g=Ie,ue=je,ce=Le,pe=z("DocumentCopy"),_e=we,me=Ue;return E(),U("div",He,[e[22]||(e[22]=s("div",{class:"page-header"},[s("div",{class:"header-content"},[s("h1",{class:"page-title"},"用户数据管理"),s("p",{class:"page-subtitle"},"查看和管理用户数据记录")])],-1)),t(T,{class:"filter-card",shadow:"never"},{default:a(()=>[t(se,{model:r,inline:"",class:"search-form"},{default:a(()=>[t(_,{label:"用户名"},{default:a(()=>[t(p,{modelValue:r.username,"onUpdate:modelValue":e[0]||(e[0]=n=>r.username=n),placeholder:"请输入用户名",clearable:"",onKeyup:be(S,["enter"])},null,8,["modelValue"])]),_:1}),t(_,{label:"数据类型"},{default:a(()=>[t(le,{modelValue:r.data_type,"onUpdate:modelValue":e[1]||(e[1]=n=>r.data_type=n),placeholder:"选择数据类型",clearable:""},{default:a(()=>[t(x,{label:"全部",value:""}),t(x,{label:"用户信息",value:"user_info"}),t(x,{label:"业务数据",value:"business_data"}),t(x,{label:"系统配置",value:"system_config"})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"创建时间"},{default:a(()=>[t(ne,{modelValue:r.dateRange,"onUpdate:modelValue":e[2]||(e[2]=n=>r.dateRange=n),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),t(_,null,{default:a(()=>[t(u,{type:"primary",onClick:S},{default:a(()=>[t(v,null,{default:a(()=>[t(oe)]),_:1}),e[8]||(e[8]=o(" 搜索 ",-1))]),_:1}),t(u,{onClick:K},{default:a(()=>[t(v,null,{default:a(()=>[t(I)]),_:1}),e[9]||(e[9]=o(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(T,{class:"table-card",shadow:"never"},{header:a(()=>[s("div",Je,[e[12]||(e[12]=s("span",{class:"table-title"},"数据记录",-1)),s("div",Pe,[t(u,{type:"primary",onClick:X,loading:V.value},{default:a(()=>[t(v,null,{default:a(()=>[t(L)]),_:1}),e[10]||(e[10]=o(" 导出数据 ",-1))]),_:1},8,["loading"]),t(u,{onClick:y},{default:a(()=>[t(v,null,{default:a(()=>[t(I)]),_:1}),e[11]||(e[11]=o(" 刷新 ",-1))]),_:1})])])]),default:a(()=>[he((E(),De(ie,{data:M.value,class:"data-table",stripe:"",onSelectionChange:W},{default:a(()=>[t(f,{type:"selection",width:"55"}),t(f,{prop:"id",label:"ID",width:"80"}),t(f,{label:"用户信息","min-width":"150"},{default:a(({row:n})=>[s("div",Ae,[s("div",Ke,d(n.username),1),s("div",qe,"ID: "+d(n.user_id),1)])]),_:1}),t(f,{label:"数据类型",width:"120"},{default:a(({row:n})=>[t(N,{type:$(n.data_type)},{default:a(()=>[o(d(Y(n.data_type)),1)]),_:2},1032,["type"])]),_:1}),t(f,{label:"数据内容","min-width":"300"},{default:a(({row:n})=>[s("div",Ge,[s("div",We,d(P(n.data)),1),t(u,{type:"text",size:"small",onClick:O=>j(n)},{default:a(()=>[...e[13]||(e[13]=[o(" 查看详情 ",-1)])]),_:2},1032,["onClick"])])]),_:1}),t(f,{label:"数据大小",width:"100"},{default:a(({row:n})=>[s("span",Qe,d(A(n.data)),1)]),_:1}),t(f,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:n})=>[o(d(k(n.created_at)),1)]),_:1}),t(f,{prop:"updated_at",label:"更新时间",width:"180"},{default:a(({row:n})=>[o(d(k(n.updated_at)),1)]),_:1}),t(f,{label:"操作",width:"150",fixed:"right"},{default:a(({row:n})=>[t(re,null,{default:a(()=>[t(u,{type:"primary",size:"small",onClick:O=>j(n)},{default:a(()=>[...e[14]||(e[14]=[o(" 查看 ",-1)])]),_:2},1032,["onClick"]),t(u,{type:"danger",size:"small",onClick:O=>Q(n)},{default:a(()=>[...e[15]||(e[15]=[o(" 删除 ",-1)])]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[me,B.value]]),s("div",Xe,[t(de,{"current-page":c.current,"onUpdate:currentPage":e[3]||(e[3]=n=>c.current=n),"page-size":c.size,"onUpdate:pageSize":e[4]||(e[4]=n=>c.size=n),total:c.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:q,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1}),h.value.length>0?(E(),U("div",Ze,[t(T,{shadow:"always"},{default:a(()=>[s("div",et,[s("span",tt,"已选择 "+d(h.value.length)+" 条数据",1),s("div",at,[t(u,{type:"primary",onClick:Z},{default:a(()=>[...e[16]||(e[16]=[o("批量导出",-1)])]),_:1}),t(u,{type:"danger",onClick:ee},{default:a(()=>[...e[17]||(e[17]=[o("批量删除",-1)])]),_:1})])])]),_:1})])):H("",!0),t(_e,{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=n=>D.value=n),title:"数据详情",width:"800px"},{footer:a(()=>[t(u,{onClick:e[6]||(e[6]=n=>D.value=!1)},{default:a(()=>[...e[21]||(e[21]=[o("关闭",-1)])]),_:1})]),default:a(()=>[i.value?(E(),U("div",lt,[t(ue,{column:2,border:""},{default:a(()=>[t(g,{label:"ID"},{default:a(()=>[o(d(i.value.id),1)]),_:1}),t(g,{label:"用户名"},{default:a(()=>[o(d(i.value.username),1)]),_:1}),t(g,{label:"用户ID"},{default:a(()=>[o(d(i.value.user_id),1)]),_:1}),t(g,{label:"数据类型"},{default:a(()=>[t(N,{type:$(i.value.data_type)},{default:a(()=>[o(d(Y(i.value.data_type)),1)]),_:1},8,["type"])]),_:1}),t(g,{label:"创建时间"},{default:a(()=>[o(d(k(i.value.created_at)),1)]),_:1}),t(g,{label:"更新时间"},{default:a(()=>[o(d(k(i.value.updated_at)),1)]),_:1})]),_:1}),t(ce,null,{default:a(()=>[...e[18]||(e[18]=[o("数据内容",-1)])]),_:1}),s("div",nt,[t(p,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=n=>C.value=n),type:"textarea",rows:20,readonly:"",resize:"none",class:"json-textarea"},null,8,["modelValue"])]),s("div",ot,[t(u,{type:"primary",onClick:te},{default:a(()=>[t(v,null,{default:a(()=>[t(pe)]),_:1}),e[19]||(e[19]=o(" 复制内容 ",-1))]),_:1}),t(u,{onClick:ae},{default:a(()=>[t(v,null,{default:a(()=>[t(L)]),_:1}),e[20]||(e[20]=o(" 下载JSON ",-1))]),_:1})])])):H("",!0)]),_:1},8,["modelValue"])])}}}),ht=fe(st,[["__scopeId","data-v-e17fb248"]]);export{ht as default};
