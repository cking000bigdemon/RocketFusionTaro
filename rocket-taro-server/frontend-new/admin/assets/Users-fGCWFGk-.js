import{_ as _e}from"./_plugin-vue_export-helper-BwE83l92.js";/* empty css                        *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                */import{l as fe,r as b,h as D,c as ge,d as ve,m as O,t as r,H as a,D as F,B as t,q as h,F as n,a8 as P,W as Y,C as be,A as R}from"./vue-vendor-CvPKWCuE.js";import{V as we,an as ye,aq as Ve,M as u,S as Ce,T as he,$ as Ue,a0 as xe,ar as Ee,as as ke,at as ze,au as Be,aa as Se,W as _,av as Te,ao as $e,aw as De,ax as Fe,ay as Pe,ad as k,ak as Re,az as qe}from"./element-plus-CWGZaCRY.js";import{b as Ie,u as Me}from"./index-C1UAl2ua.js";const je={class:"users-page"},Ae={class:"page-header"},Ne={class:"header-actions"},Oe={class:"user-info"},Ye={class:"user-details"},Ge={class:"username"},He={class:"email"},Ke={class:"pagination-wrapper"},Le={key:0,class:"batch-actions"},We={class:"batch-content"},Je={class:"batch-info"},Qe={class:"batch-buttons"},Xe=fe({__name:"Users",setup(Ze){const{apiClient:V}=Ie(),G=Me(),z=b(!1),B=b(!1),q=b([]),C=b([]),w=b(!1),m=b(null),U=b(),i=D({username:"",email:"",status:""}),o=D({username:"",email:"",password:"",confirmPassword:"",is_admin:!1,is_active:!0}),d=D({current:1,size:20,total:0}),H=ge(()=>{var s;return(s=G.user)==null?void 0:s.id}),K={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在3-20个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:50,message:"密码长度在6-50个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(s,e,v)=>{e!==o.password?v(new Error("两次输入的密码不一致")):v()},trigger:"blur"}]},g=async()=>{z.value=!0;try{const s=await V.adminGetUserList({page:d.current,size:d.size,username:i.username||void 0,email:i.email||void 0,status:i.status||void 0});s.code===200?(q.value=s.data.users||[],d.total=s.data.total||0):u.error(s.message||"获取用户列表失败")}catch(s){console.error("Failed to fetch users:",s),u.error("获取用户列表失败")}finally{z.value=!1}},x=()=>{d.current=1,g()},L=()=>{Object.assign(i,{username:"",email:"",status:""}),x()},W=s=>{d.size=s,g()},J=s=>{d.current=s,g()},Q=s=>{C.value=s},X=s=>{m.value=s,Object.assign(o,{username:s.username,email:s.email,password:"",confirmPassword:"",is_admin:s.is_admin,is_active:s.is_active}),w.value=!0},Z=async s=>{try{const e=s.is_active?"禁用":"启用";await k.confirm(`确定要${e}用户 "${s.username}" 吗？`,`确认${e}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const v=await V.adminUpdateUser(s.id,{is_active:!s.is_active});v.code===200?(u.success(`用户已${e}`),await g()):u.error(v.message||`${e}失败`)}catch{}},ee=async s=>{try{await k.confirm(`确定要删除用户 "${s.username}" 吗？此操作不可撤销。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await V.adminDeleteUser(s.id);e.code===200?(u.success("用户已删除"),await g()):u.error(e.message||"删除失败")}catch{}},ae=async()=>{try{await k.confirm(`确定要批量切换 ${C.value.length} 个用户的状态吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.info("批量操作功能开发中...")}catch{}},te=async()=>{try{await k.confirm(`确定要批量删除 ${C.value.length} 个用户吗？此操作不可撤销。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),u.info("批量删除功能开发中...")}catch{}},le=async()=>{if(U.value)try{if(!await U.value.validate())return;B.value=!0;let e;m.value?e=await V.adminUpdateUser(m.value.id,{email:o.email,is_admin:o.is_admin,is_active:o.is_active}):e=await V.adminCreateUser({username:o.username,email:o.email,password:o.password,is_admin:o.is_admin,is_active:o.is_active}),e.code===200?(u.success(m.value?"用户更新成功":"用户创建成功"),w.value=!1,await g()):u.error(e.message||"操作失败")}catch(s){console.error("User operation failed:",s),u.error("操作失败，请重试")}finally{B.value=!1}},se=()=>{var s;m.value=null,Object.assign(o,{username:"",email:"",password:"",confirmPassword:"",is_admin:!1,is_active:!0}),(s=U.value)==null||s.resetFields()},I=s=>Re(s).format("YYYY-MM-DD HH:mm:ss");return ve(()=>{g()}),(s,e)=>{const v=P("Plus"),S=Ce,c=we,y=xe,p=Ue,T=ke,oe=Ee,ne=P("Search"),re=P("Refresh"),M=he,$=ye,f=Be,ie=Se,j=Te,de=$e,ue=qe,me=De,E=Pe,A=Fe,ce=Ve,pe=ze;return h(),O("div",je,[r("div",Ae,[e[15]||(e[15]=r("div",{class:"header-content"},[r("h1",{class:"page-title"},"用户管理"),r("p",{class:"page-subtitle"},"管理系统用户信息和权限")],-1)),r("div",Ne,[a(c,{type:"primary",onClick:e[0]||(e[0]=l=>w.value=!0)},{default:t(()=>[a(S,null,{default:t(()=>[a(v)]),_:1}),e[14]||(e[14]=n(" 新增用户 ",-1))]),_:1})])]),a($,{class:"filter-card",shadow:"never"},{default:t(()=>[a(M,{model:i,inline:"",class:"search-form"},{default:t(()=>[a(p,{label:"用户名"},{default:t(()=>[a(y,{modelValue:i.username,"onUpdate:modelValue":e[1]||(e[1]=l=>i.username=l),placeholder:"请输入用户名",clearable:"",onKeyup:Y(x,["enter"])},null,8,["modelValue"])]),_:1}),a(p,{label:"邮箱"},{default:t(()=>[a(y,{modelValue:i.email,"onUpdate:modelValue":e[2]||(e[2]=l=>i.email=l),placeholder:"请输入邮箱",clearable:"",onKeyup:Y(x,["enter"])},null,8,["modelValue"])]),_:1}),a(p,{label:"状态"},{default:t(()=>[a(oe,{modelValue:i.status,"onUpdate:modelValue":e[3]||(e[3]=l=>i.status=l),placeholder:"选择状态",clearable:""},{default:t(()=>[a(T,{label:"全部",value:""}),a(T,{label:"正常",value:"active"}),a(T,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),a(p,null,{default:t(()=>[a(c,{type:"primary",onClick:x},{default:t(()=>[a(S,null,{default:t(()=>[a(ne)]),_:1}),e[16]||(e[16]=n(" 搜索 ",-1))]),_:1}),a(c,{onClick:L},{default:t(()=>[a(S,null,{default:t(()=>[a(re)]),_:1}),e[17]||(e[17]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a($,{class:"table-card",shadow:"never"},{default:t(()=>[be((h(),R(ue,{data:q.value,class:"users-table",stripe:"",onSelectionChange:Q},{default:t(()=>[a(f,{type:"selection",width:"55"}),a(f,{prop:"id",label:"ID",width:"80"}),a(f,{label:"用户信息","min-width":"200"},{default:t(({row:l})=>[r("div",Oe,[a(ie,{size:40,class:"user-avatar"},{default:t(()=>[n(_(l.username.charAt(0).toUpperCase()),1)]),_:2},1024),r("div",Ye,[r("div",Ge,_(l.username),1),r("div",He,_(l.email),1)])])]),_:1}),a(f,{label:"角色",width:"100"},{default:t(({row:l})=>[a(j,{type:l.is_admin?"danger":"primary"},{default:t(()=>[n(_(l.is_admin?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(f,{label:"状态",width:"100"},{default:t(({row:l})=>[a(j,{type:l.is_active?"success":"danger"},{default:t(()=>[n(_(l.is_active?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(f,{prop:"created_at",label:"创建时间",width:"180"},{default:t(({row:l})=>[n(_(I(l.created_at)),1)]),_:1}),a(f,{prop:"last_login",label:"最后登录",width:"180"},{default:t(({row:l})=>[n(_(l.last_login?I(l.last_login):"-"),1)]),_:1}),a(f,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[a(de,null,{default:t(()=>[a(c,{type:"primary",size:"small",onClick:N=>X(l)},{default:t(()=>[...e[18]||(e[18]=[n(" 编辑 ",-1)])]),_:2},1032,["onClick"]),a(c,{type:l.is_active?"warning":"success",size:"small",onClick:N=>Z(l)},{default:t(()=>[n(_(l.is_active?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),a(c,{type:"danger",size:"small",onClick:N=>ee(l),disabled:l.id===H.value},{default:t(()=>[...e[19]||(e[19]=[n(" 删除 ",-1)])]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[pe,z.value]]),r("div",Ke,[a(me,{"current-page":d.current,"onUpdate:currentPage":e[4]||(e[4]=l=>d.current=l),"page-size":d.size,"onUpdate:pageSize":e[5]||(e[5]=l=>d.size=l),total:d.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:W,onCurrentChange:J},null,8,["current-page","page-size","total"])])]),_:1}),C.value.length>0?(h(),O("div",Le,[a($,{shadow:"always"},{default:t(()=>[r("div",We,[r("span",Je,"已选择 "+_(C.value.length)+" 个用户",1),r("div",Qe,[a(c,{type:"warning",onClick:ae},{default:t(()=>[...e[20]||(e[20]=[n("批量禁用/启用",-1)])]),_:1}),a(c,{type:"danger",onClick:te},{default:t(()=>[...e[21]||(e[21]=[n("批量删除",-1)])]),_:1})])])]),_:1})])):F("",!0),a(ce,{modelValue:w.value,"onUpdate:modelValue":e[13]||(e[13]=l=>w.value=l),title:m.value?"编辑用户":"新增用户",width:"600px",onClose:se},{footer:t(()=>[a(c,{onClick:e[12]||(e[12]=l=>w.value=!1)},{default:t(()=>[...e[26]||(e[26]=[n("取消",-1)])]),_:1}),a(c,{type:"primary",loading:B.value,onClick:le},{default:t(()=>[n(_(m.value?"更新":"创建"),1)]),_:1},8,["loading"])]),default:t(()=>[a(M,{ref_key:"userFormRef",ref:U,model:o,rules:K,"label-width":"100px"},{default:t(()=>[a(p,{label:"用户名",prop:"username"},{default:t(()=>[a(y,{modelValue:o.username,"onUpdate:modelValue":e[6]||(e[6]=l=>o.username=l),placeholder:"请输入用户名",disabled:!!m.value},null,8,["modelValue","disabled"])]),_:1}),a(p,{label:"邮箱",prop:"email"},{default:t(()=>[a(y,{modelValue:o.email,"onUpdate:modelValue":e[7]||(e[7]=l=>o.email=l),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1}),m.value?F("",!0):(h(),R(p,{key:0,label:"密码",prop:"password"},{default:t(()=>[a(y,{modelValue:o.password,"onUpdate:modelValue":e[8]||(e[8]=l=>o.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),m.value?F("",!0):(h(),R(p,{key:1,label:"确认密码",prop:"confirmPassword"},{default:t(()=>[a(y,{modelValue:o.confirmPassword,"onUpdate:modelValue":e[9]||(e[9]=l=>o.confirmPassword=l),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1})),a(p,{label:"角色"},{default:t(()=>[a(A,{modelValue:o.is_admin,"onUpdate:modelValue":e[10]||(e[10]=l=>o.is_admin=l)},{default:t(()=>[a(E,{label:!1},{default:t(()=>[...e[22]||(e[22]=[n("普通用户",-1)])]),_:1}),a(E,{label:!0},{default:t(()=>[...e[23]||(e[23]=[n("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(p,{label:"状态"},{default:t(()=>[a(A,{modelValue:o.is_active,"onUpdate:modelValue":e[11]||(e[11]=l=>o.is_active=l)},{default:t(()=>[a(E,{label:!0},{default:t(()=>[...e[24]||(e[24]=[n("正常",-1)])]),_:1}),a(E,{label:!1},{default:t(()=>[...e[25]||(e[25]=[n("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ma=_e(Xe,[["__scopeId","data-v-eff46725"]]);export{ma as default};
