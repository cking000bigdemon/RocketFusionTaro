import{c as R,d as j,r as S,F as Be,a as T,f as U,G as X,w as he,H as Ae,J as Le,x as ie,K,b as t,n as $,t as W,L as J,M as _e,N as Ue,j as Q,I as re,k as M,O as oe,E as F,P as ue,Q as Z,R as ee,S as ze,T as Ne,U as Ie,V as Ve,W as Oe,X as Ee,Y as Fe,Z as Re,p as de,_ as je,$ as Me,a0 as qe,e as He,a1 as Ye,g as Ge,a2 as Xe,a3 as Ke,a4 as We,o as Je,q as Qe,v as Ze,s as et,a5 as tt,y as z,z as te,a6 as N,A as L,B as x,a7 as ae,a8 as at,C as ne,a9 as fe,aa as Y,ab as ve,D as nt}from"./index-c37badf3.js";import{T as ye,N as ot,f as it}from"./index-9d907a6e.js";import{_ as rt}from"./_plugin-vue_export-helper-a85ffdf4.js";import{C as lt,F as st}from"./index-a70f1cdd.js";import{C as ct}from"./index-75643b11.js";import{F as ut}from"./index-7abfd830.js";function me(e,a){return e.reduce((l,i)=>Math.abs(l-a)<Math.abs(i-a)?l:i)}const[dt,V]=R("image"),ft={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:$,height:$,radius:$,lazyLoad:Boolean,iconSize:$,showError:W,errorIcon:J("photo-fail"),iconPrefix:String,showLoading:W,loadingIcon:J("photo"),crossorigin:String,referrerpolicy:String,decoding:String};var vt=j({name:dt,props:ft,emits:["load","error"],setup(e,{emit:a,slots:l}){const i=S(!1),f=S(!0),r=S(),{$Lazyload:g}=Be().proxy,P=T(()=>{const o={width:U(e.width),height:U(e.height)};return X(e.radius)&&(o.overflow="hidden",o.borderRadius=U(e.radius)),o});he(()=>e.src,()=>{i.value=!1,f.value=!0});const n=o=>{f.value&&(f.value=!1,a("load",o))},v=()=>{const o=new Event("load");Object.defineProperty(o,"target",{value:r.value,enumerable:!0}),n(o)},p=o=>{i.value=!0,f.value=!1,a("error",o)},_=(o,C,D)=>D?D():t(re,{name:o,size:e.iconSize,class:C,classPrefix:e.iconPrefix},null),y=()=>{if(f.value&&e.showLoading)return t("div",{class:V("loading")},[_(e.loadingIcon,V("loading-icon"),l.loading)]);if(i.value&&e.showError)return t("div",{class:V("error")},[_(e.errorIcon,V("error-icon"),l.error)])},h=()=>{if(i.value||!e.src)return;const o={alt:e.alt,class:V("img"),decoding:e.decoding,style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?_e(t("img",Q({ref:r},o),null),[[Ue("lazy"),e.src]]):t("img",Q({ref:r,src:e.src,onLoad:n,onError:p},o),null)},b=({el:o})=>{const C=()=>{o===r.value&&f.value&&v()};r.value?C():K(C)},w=({el:o})=>{o===r.value&&!i.value&&p()};return g&&Ae&&(g.$on("loaded",b),g.$on("error",w),Le(()=>{g.$off("loaded",b),g.$off("error",w)})),ie(()=>{K(()=>{var o;(o=r.value)!=null&&o.complete&&!e.lazyLoad&&v()})}),()=>{var o;return t("div",{class:V({round:e.round,block:e.block}),style:P.value},[h(),y(),(o=l.default)==null?void 0:o.call(l)])}}});const mt=M(vt),[gt,k]=R("card"),ht={tag:String,num:$,desc:String,thumb:String,title:String,price:$,centered:Boolean,lazyLoad:Boolean,currency:J("¥"),thumbLink:String,originPrice:$};var _t=j({name:gt,props:ht,emits:["clickThumb"],setup(e,{slots:a,emit:l}){const i=()=>{if(a.title)return a.title();if(e.title)return t("div",{class:[k("title"),"van-multi-ellipsis--l2"]},[e.title])},f=()=>{if(a.tag||e.tag)return t("div",{class:k("tag")},[a.tag?a.tag():t(ye,{mark:!0,type:"primary"},{default:()=>[e.tag]})])},r=()=>a.thumb?a.thumb():t(mt,{src:e.thumb,fit:"cover",width:"100%",height:"100%",lazyLoad:e.lazyLoad},null),g=()=>{if(a.thumb||e.thumb)return t("a",{href:e.thumbLink,class:k("thumb"),onClick:v=>l("clickThumb",v)},[r(),f()])},P=()=>{if(a.desc)return a.desc();if(e.desc)return t("div",{class:[k("desc"),"van-ellipsis"]},[e.desc])},n=()=>{const v=e.price.toString().split(".");return t("div",null,[t("span",{class:k("price-currency")},[e.currency]),t("span",{class:k("price-integer")},[v[0]]),v.length>1&&t(oe,null,[F("."),t("span",{class:k("price-decimal")},[v[1]])])])};return()=>{var v,p,_;const y=a.num||X(e.num),h=a.price||X(e.price),b=a["origin-price"]||X(e.originPrice),w=y||h||b||a.bottom,o=h&&t("div",{class:k("price")},[a.price?a.price():n()]),C=b&&t("div",{class:k("origin-price")},[a["origin-price"]?a["origin-price"]():`${e.currency} ${e.originPrice}`]),D=y&&t("div",{class:k("num")},[a.num?a.num():`x${e.num}`]),I=a.footer&&t("div",{class:k("footer")},[a.footer()]),B=w&&t("div",{class:k("bottom")},[(v=a["price-top"])==null?void 0:v.call(a),o,C,D,(p=a.bottom)==null?void 0:p.call(a)]);return t("div",{class:k()},[t("div",{class:k("header")},[g(),t("div",{class:k("content",{centered:e.centered})},[t("div",null,[i(),P(),(_=a.tags)==null?void 0:_.call(a)]),B])]),I])}}});const yt=M(_t),bt={gap:{type:[Number,Object],default:24},icon:String,axis:J("y"),magnetic:String,offset:Object,teleport:{type:[String,Object],default:"body"}},[pt,ge]=R("floating-bubble");var wt=j({name:pt,inheritAttrs:!1,props:bt,emits:["click","update:offset","offsetChange"],setup(e,{slots:a,emit:l,attrs:i}){const f=S(),r=S({x:0,y:0,width:0,height:0}),g=T(()=>ue(e.gap)?e.gap.x:e.gap),P=T(()=>ue(e.gap)?e.gap.y:e.gap),n=T(()=>({top:P.value,right:Z.value-r.value.width-g.value,bottom:ee.value-r.value.height-P.value,left:g.value})),v=S(!1);let p=!1;const _=T(()=>{const s={},A=U(r.value.x),m=U(r.value.y);return s.transform=`translate3d(${A}, ${m}, 0)`,(v.value||!p)&&(s.transition="none"),s}),y=()=>{if(!B.value)return;const{width:s,height:A}=Re(f.value),{offset:m}=e;r.value={x:m?m.x:Z.value-s-g.value,y:m?m.y:ee.value-A-P.value,width:s,height:A}},h=ze();let b=0,w=0;const o=s=>{h.start(s),v.value=!0,b=r.value.x,w=r.value.y};Ne("touchmove",s=>{if(s.preventDefault(),h.move(s),e.axis!=="lock"&&!h.isTap.value){if(e.axis==="x"||e.axis==="xy"){let m=b+h.deltaX.value;m<n.value.left&&(m=n.value.left),m>n.value.right&&(m=n.value.right),r.value.x=m}if(e.axis==="y"||e.axis==="xy"){let m=w+h.deltaY.value;m<n.value.top&&(m=n.value.top),m>n.value.bottom&&(m=n.value.bottom),r.value.y=m}const A=de(r.value,["x","y"]);l("update:offset",A)}},{target:f});const D=()=>{v.value=!1,K(()=>{if(e.magnetic==="x"){const s=me([n.value.left,n.value.right],r.value.x);r.value.x=s}if(e.magnetic==="y"){const s=me([n.value.top,n.value.bottom],r.value.y);r.value.y=s}if(!h.isTap.value){const s=de(r.value,["x","y"]);l("update:offset",s),(b!==s.x||w!==s.y)&&l("offsetChange",s)}})},I=s=>{h.isTap.value?l("click",s):s.stopPropagation()};ie(()=>{y(),K(()=>{p=!0})}),he([Z,ee,g,P,()=>e.offset],y,{deep:!0});const B=S(!0);return Ie(()=>{B.value=!0}),Ve(()=>{e.teleport&&(B.value=!1)}),()=>{const s=_e(t("div",Q({class:ge(),ref:f,onTouchstartPassive:o,onTouchend:D,onTouchcancel:D,onClickCapture:I,style:_.value},i),[a.default?a.default():t(Ee,{name:e.icon,class:ge("icon")},null)]),[[Oe,B.value]]);return e.teleport?t(Fe,{to:e.teleport},{default:()=>[s]}):s}}});const xt=M(wt),[be,kt]=R("grid"),St={square:Boolean,center:W,border:W,gutter:$,reverse:Boolean,iconSize:$,direction:String,clickable:Boolean,columnNum:je(4)},pe=Symbol(be);var Pt=j({name:be,props:St,setup(e,{slots:a}){const{linkChildren:l}=Me(pe);return l({props:e}),()=>{var i;return t("div",{style:{paddingLeft:U(e.gutter)},class:[kt(),{[qe]:e.border&&!e.gutter}]},[(i=a.default)==null?void 0:i.call(a)])}}});const Ct=M(Pt),[Tt,G]=R("grid-item"),$t=He({},Ye,{dot:Boolean,text:String,icon:String,badge:$,iconColor:String,iconPrefix:String,badgeProps:Object});var Dt=j({name:Tt,props:$t,setup(e,{slots:a}){const{parent:l,index:i}=Ge(pe),f=Xe();if(!l)return;const r=T(()=>{const{square:p,gutter:_,columnNum:y}=l.props,h=`${100/+y}%`,b={flexBasis:h};if(p)b.paddingTop=h;else if(_){const w=U(_);b.paddingRight=w,i.value>=+y&&(b.marginTop=w)}return b}),g=T(()=>{const{square:p,gutter:_}=l.props;if(p&&_){const y=U(_);return{right:y,bottom:y,height:"auto"}}}),P=()=>{if(a.icon)return t(We,Q({dot:e.dot,content:e.badge},e.badgeProps),{default:a.icon});if(e.icon)return t(re,{dot:e.dot,name:e.icon,size:l.props.iconSize,badge:e.badge,class:G("icon"),color:e.iconColor,badgeProps:e.badgeProps,classPrefix:e.iconPrefix},null)},n=()=>{if(a.text)return a.text();if(e.text)return t("span",{class:G("text")},[e.text])},v=()=>a.default?a.default():[P(),n()];return()=>{const{center:p,border:_,square:y,gutter:h,reverse:b,direction:w,clickable:o}=l.props,C=[G("content",[w,{center:p,square:y,reverse:b,clickable:o,surround:_&&h}]),{[Ke]:_}];return t("div",{class:[G({square:y})],style:r.value},[t("div",{role:o?"button":void 0,class:C,style:g.value,tabindex:o?0:void 0,onClick:f},[v()])])}}});const Bt=M(Dt);const At={class:"home-page"},Lt={class:"user-info-card"},Ut={class:"avatar"},zt={class:"user-name"},Nt={class:"user-role"},It={class:"user-actions"},Vt={class:"function-menu"},Ot={class:"data-overview"},Et={class:"system-status"},Ft={__name:"Home",setup(e){const a=Je(),l=Qe(),i=Ze(),f=S([]),r=S(!1),g=S(!1),P=S(null),n=et({name:"",description:"",data_type:"",content:""}),v=S("1.0.0"),p=T(()=>f.value.slice(0,3)),_=T(()=>l.isOnline?"在线":"离线"),y=T(()=>{const u=l.networkStatus;return l.isOnline?u.type&&u.type!=="unknown"?`${u.type.toUpperCase()}${u.downlink?` (${u.downlink}Mbps)`:""}`:"网络连接正常":"网络连接已断开"}),h=S([{id:"user-data",icon:"records",text:"我的数据",action:"viewAllUserData"},{id:"add-data",icon:"add-o",text:"添加数据",action:"showAddDataDialog"},{id:"profile",icon:"contact",text:"个人资料",action:"viewProfile"},{id:"settings",icon:"setting-o",text:"设置",action:"goToSettings"}]);function b(u){const c=u.action;if(typeof window[c]=="function")window[c]();else if(typeof this[c]=="function")this[c]();else switch(c){case"viewAllUserData":B();break;case"showAddDataDialog":A();break;case"viewProfile":C();break;case"goToSettings":o();break;default:console.warn("Unknown menu action:",c)}}function w(){i.platformAdapter.goBack()}function o(){i.smartNavigate("/settings")}function C(){i.smartNavigate("/profile")}async function D(){if((await i.platformAdapter.showConfirm("确认退出","确定要退出登录吗？","取消","确定")).confirm)try{await ae.mobileLogout()}catch(c){console.error("Logout failed:",c),a.clearUser(),i.smartNavigate("/login",{replace:!0})}}async function I(){try{r.value=!0;const u=await ae.mobileGetUserData();u.data&&Array.isArray(u.data)&&(f.value=u.data)}catch(u){console.error("Failed to load user data:",u),await i.platformAdapter.showToast("加载数据失败","error")}finally{r.value=!1}}function B(){i.smartNavigate("/user-data")}function s(u){i.smartNavigate("/user-data",{query:{id:u.id}})}function A(){g.value=!0,Object.assign(n,{name:"",description:"",data_type:"",content:""})}async function m(){var u,c;try{if(!n.name||!n.data_type||!n.content){await i.platformAdapter.showToast("请填写完整信息","error");return}const O=await ae.mobileAddUserData({name:n.name.trim(),description:n.description.trim(),data_type:n.data_type.trim(),content:n.content.trim(),is_public:!1});await I(),g.value=!1,await i.platformAdapter.showToast("添加成功","success")}catch(O){console.error("Failed to add user data:",O);const q=((c=(u=O.response)==null?void 0:u.data)==null?void 0:c.message)||"添加失败";await i.platformAdapter.showToast(q,"error")}}function we(u){return{text:"primary",json:"success",image:"warning",file:"default"}[u]||"default"}async function xe(){await i.platformAdapter.showToast("已是最新版本","success")}return ie(async()=>{const u=l.getAppInfo();v.value=u.version,await I(),await i.platformAdapter.setPageTitle(`首页 - ${a.getDisplayName()}`)}),tt(()=>{}),(u,c)=>{const O=ot,q=re,le=ye,se=nt,ke=yt,Se=Bt,Pe=Ct,E=lt,ce=ct,Ce=xt,H=st,Te=ut,$e=at;return z(),te("div",At,[t(O,{title:`欢迎，${N(a).getDisplayName()}`,"left-text":"返回","right-text":"设置","left-arrow":"",onClickLeft:w,onClickRight:o},null,8,["title"]),L("div",Lt,[t(ke,null,{thumb:x(()=>[L("div",Ut,[t(q,{name:"user-o",size:"40"})])]),title:x(()=>[L("div",zt,ne(N(a).username),1)]),desc:x(()=>[L("div",Nt,[t(le,{type:N(a).isAdmin?"danger":"primary"},{default:x(()=>[F(ne(N(a).isAdmin?"管理员":"普通用户"),1)]),_:1},8,["type"])])]),footer:x(()=>[L("div",It,[t(se,{size:"mini",type:"primary",onClick:C},{default:x(()=>[...c[5]||(c[5]=[F(" 个人资料 ",-1)])]),_:1}),t(se,{size:"mini",plain:"",onClick:D},{default:x(()=>[...c[6]||(c[6]=[F(" 退出登录 ",-1)])]),_:1})])]),_:1})]),L("div",Vt,[t(Pe,{"column-num":2,gutter:10},{default:x(()=>[(z(!0),te(oe,null,fe(h.value,d=>(z(),Y(Se,{key:d.id,icon:d.icon,text:d.text,onClick:De=>b(d)},null,8,["icon","text","onClick"]))),128))]),_:1})]),L("div",Ot,[t(ce,{title:`我的数据 (${f.value.length})`},{default:x(()=>[(z(!0),te(oe,null,fe(p.value,d=>(z(),Y(E,{key:d.id,title:d.name,label:d.description||"暂无描述",value:N(it)(d.created_at),"is-link":"",onClick:De=>s(d)},{"right-icon":x(()=>[t(le,{size:"mini",type:we(d.data_type)},{default:x(()=>[F(ne(d.data_type),1)]),_:2},1032,["type"])]),_:2},1032,["title","label","value","onClick"]))),128)),f.value.length===0?(z(),Y(E,{key:0,title:"暂无数据",label:"点击上方菜单添加您的第一条数据",center:""})):ve("",!0),f.value.length>3?(z(),Y(E,{key:1,title:"查看全部",label:`还有 ${f.value.length-3} 条数据`,"is-link":"",onClick:B},null,8,["label"])):ve("",!0)]),_:1},8,["title"])]),L("div",Et,[t(ce,{title:"系统信息"},{default:x(()=>[t(E,{title:"网络状态",value:_.value,label:y.value},{"right-icon":x(()=>[t(q,{name:N(l).isOnline?"success":"fail",color:N(l).isOnline?"#07c160":"#ee0a24"},null,8,["name","color"])]),_:1},8,["value","label"]),t(E,{title:"应用版本",value:v.value,label:"点击检查更新","is-link":"",onClick:xe},null,8,["value"])]),_:1})]),t(Ce,{axis:"xy",icon:"plus",magnetic:"x",onClick:A}),t($e,{show:g.value,"onUpdate:show":c[4]||(c[4]=d=>g.value=d),title:"添加数据","show-cancel-button":"",onConfirm:m},{default:x(()=>[t(Te,{ref_key:"addForm",ref:P},{default:x(()=>[t(H,{modelValue:n.name,"onUpdate:modelValue":c[0]||(c[0]=d=>n.name=d),label:"名称",placeholder:"请输入数据名称",rules:[{required:!0,message:"请填写数据名称"}]},null,8,["modelValue"]),t(H,{modelValue:n.description,"onUpdate:modelValue":c[1]||(c[1]=d=>n.description=d),label:"描述",placeholder:"请输入数据描述（可选）"},null,8,["modelValue"]),t(H,{modelValue:n.data_type,"onUpdate:modelValue":c[2]||(c[2]=d=>n.data_type=d),label:"类型",placeholder:"请输入数据类型",rules:[{required:!0,message:"请选择数据类型"}]},null,8,["modelValue"]),t(H,{modelValue:n.content,"onUpdate:modelValue":c[3]||(c[3]=d=>n.content=d),type:"textarea",label:"内容",placeholder:"请输入数据内容",rules:[{required:!0,message:"请填写数据内容"}],rows:"3"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["show"])])}}},Gt=rt(Ft,[["__scopeId","data-v-2d49c291"]]);export{Gt as default};
