import{c as H,d as Y,r as $,F as Ve,a as N,f as V,G as ce,w as pe,H as Fe,J as Me,x as ve,K as ee,b as n,n as U,t as q,L as ue,M as be,N as He,j as te,I as fe,k as X,O as he,E as D,e as Te,g as Ce,P as je,Q as Ge,h as qe,R as Ye,p as de,S as Le,T as we,U as me,V as ge,W as Xe,X as Ke,Y as We,Z as Qe,_ as Je,$ as Ze,a0 as et,a1 as tt,a2 as at,a3 as st,a4 as nt,a5 as ot,a6 as it,a7 as rt,a8 as Z,a9 as $e,y as x,z,B as P,aa as M,ab as Q,A as o,C as L,ac as I,ad as lt,D as Pe,o as ct,q as ut,v as dt,s as vt,ae as J,af as ft,ag as ke}from"./index-078b64ab.js";import{T as Be,f as ze,N as mt}from"./index-9381f699.js";import{_ as Ie}from"./_plugin-vue_export-helper-a85ffdf4.js";import{c as Ne,C as _e,F as gt}from"./index-7708d5b5.js";import{C as ht}from"./index-fb2d1b7b.js";import{F as pt}from"./index-27bd689a.js";function Se(t,e){return t.reduce((i,a)=>Math.abs(i-e)<Math.abs(a-e)?i:a)}const[bt,G]=H("image"),_t={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:U,height:U,radius:U,lazyLoad:Boolean,iconSize:U,showError:q,errorIcon:ue("photo-fail"),iconPrefix:String,showLoading:q,loadingIcon:ue("photo"),crossorigin:String,referrerpolicy:String,decoding:String};var yt=Y({name:bt,props:_t,emits:["load","error"],setup(t,{emit:e,slots:i}){const a=$(!1),f=$(!0),u=$(),{$Lazyload:m}=Ve().proxy,b=N(()=>{const r={width:V(t.width),height:V(t.height)};return ce(t.radius)&&(r.overflow="hidden",r.borderRadius=V(t.radius)),r});pe(()=>t.src,()=>{a.value=!1,f.value=!0});const l=r=>{f.value&&(f.value=!1,e("load",r))},g=()=>{const r=new Event("load");Object.defineProperty(r,"target",{value:u.value,enumerable:!0}),l(r)},_=r=>{a.value=!0,f.value=!1,e("error",r)},h=(r,T,k)=>k?k():n(fe,{name:r,size:t.iconSize,class:T,classPrefix:t.iconPrefix},null),y=()=>{if(f.value&&t.showLoading)return n("div",{class:G("loading")},[h(t.loadingIcon,G("loading-icon"),i.loading)]);if(a.value&&t.showError)return n("div",{class:G("error")},[h(t.errorIcon,G("error-icon"),i.error)])},p=()=>{if(a.value||!t.src)return;const r={alt:t.alt,class:G("img"),decoding:t.decoding,style:{objectFit:t.fit,objectPosition:t.position},crossorigin:t.crossorigin,referrerpolicy:t.referrerpolicy};return t.lazyLoad?be(n("img",te({ref:u},r),null),[[He("lazy"),t.src]]):n("img",te({ref:u,src:t.src,onLoad:l,onError:_},r),null)},c=({el:r})=>{const T=()=>{r===u.value&&f.value&&g()};u.value?T():ee(T)},s=({el:r})=>{r===u.value&&!a.value&&_()};return m&&Fe&&(m.$on("loaded",c),m.$on("error",s),Me(()=>{m.$off("loaded",c),m.$off("error",s)})),ve(()=>{ee(()=>{var r;(r=u.value)!=null&&r.complete&&!t.lazyLoad&&g()})}),()=>{var r;return n("div",{class:G({round:t.round,block:t.block}),style:b.value},[p(),y(),(r=i.default)==null?void 0:r.call(i)])}}});const wt=X(yt),[kt,B]=H("card"),St={tag:String,num:U,desc:String,thumb:String,title:String,price:U,centered:Boolean,lazyLoad:Boolean,currency:ue("¥"),thumbLink:String,originPrice:U};var xt=Y({name:kt,props:St,emits:["clickThumb"],setup(t,{slots:e,emit:i}){const a=()=>{if(e.title)return e.title();if(t.title)return n("div",{class:[B("title"),"van-multi-ellipsis--l2"]},[t.title])},f=()=>{if(e.tag||t.tag)return n("div",{class:B("tag")},[e.tag?e.tag():n(Be,{mark:!0,type:"primary"},{default:()=>[t.tag]})])},u=()=>e.thumb?e.thumb():n(wt,{src:t.thumb,fit:"cover",width:"100%",height:"100%",lazyLoad:t.lazyLoad},null),m=()=>{if(e.thumb||t.thumb)return n("a",{href:t.thumbLink,class:B("thumb"),onClick:g=>i("clickThumb",g)},[u(),f()])},b=()=>{if(e.desc)return e.desc();if(t.desc)return n("div",{class:[B("desc"),"van-ellipsis"]},[t.desc])},l=()=>{const g=t.price.toString().split(".");return n("div",null,[n("span",{class:B("price-currency")},[t.currency]),n("span",{class:B("price-integer")},[g[0]]),g.length>1&&n(he,null,[D("."),n("span",{class:B("price-decimal")},[g[1]])])])};return()=>{var g,_,h;const y=e.num||ce(t.num),p=e.price||ce(t.price),c=e["origin-price"]||ce(t.originPrice),s=y||p||c||e.bottom,r=p&&n("div",{class:B("price")},[e.price?e.price():l()]),T=c&&n("div",{class:B("origin-price")},[e["origin-price"]?e["origin-price"]():`${t.currency} ${t.originPrice}`]),k=y&&n("div",{class:B("num")},[e.num?e.num():`x${t.num}`]),A=e.footer&&n("div",{class:B("footer")},[e.footer()]),E=s&&n("div",{class:B("bottom")},[(g=e["price-top"])==null?void 0:g.call(e),r,T,k,(_=e.bottom)==null?void 0:_.call(e)]);return n("div",{class:B()},[n("div",{class:B("header")},[m(),n("div",{class:B("content",{centered:t.centered})},[n("div",null,[a(),b(),(h=e.tags)==null?void 0:h.call(e)]),E])]),A])}}});const Tt=X(xt),[Ct,Qa]=H("collapse"),Lt=Symbol(Ct),[$t,re]=H("collapse-item"),Pt=["icon","title","value","label","right-icon"],Bt=Te({},Ne,{name:U,isLink:q,disabled:Boolean,readonly:Boolean,lazyRender:q});var zt=Y({name:$t,props:Bt,setup(t,{slots:e}){const i=$(),a=$(),{parent:f,index:u}=Ce(Lt);if(!f)return;const m=N(()=>{var s;return(s=t.name)!=null?s:u.value}),b=N(()=>f.isExpanded(m.value)),l=$(b.value),g=je(()=>l.value||!t.lazyRender),_=()=>{b.value?i.value&&(i.value.style.height=""):l.value=!1};pe(b,(s,r)=>{if(r===null)return;s&&(l.value=!0),(s?ee:Ye)(()=>{if(!a.value||!i.value)return;const{offsetHeight:k}=a.value;if(k){const A=`${k}px`;i.value.style.height=s?"0":A,Ge(()=>{i.value&&(i.value.style.height=s?A:"0")})}else _()})});const h=(s=!b.value)=>{f.toggle(m.value,s)},y=()=>{!t.disabled&&!t.readonly&&h()},p=()=>{const{border:s,disabled:r,readonly:T}=t,k=de(t,Object.keys(Ne));return T&&(k.isLink=!1),(r||T)&&(k.clickable=!1),n(_e,te({role:"button",class:re("title",{disabled:r,expanded:b.value,borderless:!s}),"aria-expanded":String(b.value),onClick:y},k),de(e,Pt))},c=g(()=>{var s;return be(n("div",{ref:i,class:re("wrapper"),onTransitionend:_},[n("div",{ref:a,class:re("content")},[(s=e.default)==null?void 0:s.call(e)])]),[[Le,l.value]])});return qe({toggle:h,expanded:b,itemName:m}),()=>n("div",{class:[re({border:u.value&&t.border})]},[p(),c()])}});const It=X(zt),Nt={gap:{type:[Number,Object],default:24},icon:String,axis:ue("y"),magnetic:String,offset:Object,teleport:{type:[String,Object],default:"body"}},[At,xe]=H("floating-bubble");var Et=Y({name:At,inheritAttrs:!1,props:Nt,emits:["click","update:offset","offsetChange"],setup(t,{slots:e,emit:i,attrs:a}){const f=$(),u=$({x:0,y:0,width:0,height:0}),m=N(()=>we(t.gap)?t.gap.x:t.gap),b=N(()=>we(t.gap)?t.gap.y:t.gap),l=N(()=>({top:b.value,right:me.value-u.value.width-m.value,bottom:ge.value-u.value.height-b.value,left:m.value})),g=$(!1);let _=!1;const h=N(()=>{const d={},R=V(u.value.x),w=V(u.value.y);return d.transform=`translate3d(${R}, ${w}, 0)`,(g.value||!_)&&(d.transition="none"),d}),y=()=>{if(!E.value)return;const{width:d,height:R}=et(f.value),{offset:w}=t;u.value={x:w?w.x:me.value-d-m.value,y:w?w.y:ge.value-R-b.value,width:d,height:R}},p=Xe();let c=0,s=0;const r=d=>{p.start(d),g.value=!0,c=u.value.x,s=u.value.y};Ke("touchmove",d=>{if(d.preventDefault(),p.move(d),t.axis!=="lock"&&!p.isTap.value){if(t.axis==="x"||t.axis==="xy"){let w=c+p.deltaX.value;w<l.value.left&&(w=l.value.left),w>l.value.right&&(w=l.value.right),u.value.x=w}if(t.axis==="y"||t.axis==="xy"){let w=s+p.deltaY.value;w<l.value.top&&(w=l.value.top),w>l.value.bottom&&(w=l.value.bottom),u.value.y=w}const R=de(u.value,["x","y"]);i("update:offset",R)}},{target:f});const k=()=>{g.value=!1,ee(()=>{if(t.magnetic==="x"){const d=Se([l.value.left,l.value.right],u.value.x);u.value.x=d}if(t.magnetic==="y"){const d=Se([l.value.top,l.value.bottom],u.value.y);u.value.y=d}if(!p.isTap.value){const d=de(u.value,["x","y"]);i("update:offset",d),(c!==d.x||s!==d.y)&&i("offsetChange",d)}})},A=d=>{p.isTap.value?i("click",d):d.stopPropagation()};ve(()=>{y(),ee(()=>{_=!0})}),pe([me,ge,m,b,()=>t.offset],y,{deep:!0});const E=$(!0);return We(()=>{E.value=!0}),Qe(()=>{t.teleport&&(E.value=!1)}),()=>{const d=be(n("div",te({class:xe(),ref:f,onTouchstartPassive:r,onTouchend:k,onTouchcancel:k,onClickCapture:A,style:h.value},a),[e.default?e.default():n(Je,{name:t.icon,class:xe("icon")},null)]),[[Le,E.value]]);return t.teleport?n(Ze,{to:t.teleport},{default:()=>[d]}):d}}});const Rt=X(Et),[Ae,Ut]=H("grid"),Ot={square:Boolean,center:q,border:q,gutter:U,reverse:Boolean,iconSize:U,direction:String,clickable:Boolean,columnNum:tt(4)},Ee=Symbol(Ae);var Dt=Y({name:Ae,props:Ot,setup(t,{slots:e}){const{linkChildren:i}=at(Ee);return i({props:t}),()=>{var a;return n("div",{style:{paddingLeft:V(t.gutter)},class:[Ut(),{[st]:t.border&&!t.gutter}]},[(a=e.default)==null?void 0:a.call(e)])}}});const Vt=X(Dt),[Ft,le]=H("grid-item"),Mt=Te({},nt,{dot:Boolean,text:String,icon:String,badge:U,iconColor:String,iconPrefix:String,badgeProps:Object});var Ht=Y({name:Ft,props:Mt,setup(t,{slots:e}){const{parent:i,index:a}=Ce(Ee),f=ot();if(!i)return;const u=N(()=>{const{square:_,gutter:h,columnNum:y}=i.props,p=`${100/+y}%`,c={flexBasis:p};if(_)c.paddingTop=p;else if(h){const s=V(h);c.paddingRight=s,a.value>=+y&&(c.marginTop=s)}return c}),m=N(()=>{const{square:_,gutter:h}=i.props;if(_&&h){const y=V(h);return{right:y,bottom:y,height:"auto"}}}),b=()=>{if(e.icon)return n(rt,te({dot:t.dot,content:t.badge},t.badgeProps),{default:e.icon});if(t.icon)return n(fe,{dot:t.dot,name:t.icon,size:i.props.iconSize,badge:t.badge,class:le("icon"),color:t.iconColor,badgeProps:t.badgeProps,classPrefix:t.iconPrefix},null)},l=()=>{if(e.text)return e.text();if(t.text)return n("span",{class:le("text")},[t.text])},g=()=>e.default?e.default():[b(),l()];return()=>{const{center:_,border:h,square:y,gutter:p,reverse:c,direction:s,clickable:r}=i.props,T=[le("content",[s,{center:_,square:y,reverse:c,clickable:r,surround:h&&p}]),{[it]:h}];return n("div",{class:[le({square:y})],style:u.value},[n("div",{role:r?"button":void 0,class:T,style:m.value,tabindex:r?0:void 0,onClick:f},[g()])])}}});const jt=X(Ht);class Gt{constructor(){this.listeners=new Set,this.status={browser:{online:navigator.onLine,type:"unknown",downlink:null,rtt:null},backend:{connected:!1,status:"unknown",responseTime:null,lastCheck:null,error:null},system:{server:null,database:null,cache:null,overall:"unknown"}},this.checkInterval=null,this.isChecking=!1,this.initNetworkMonitoring()}initNetworkMonitoring(){const e=()=>{const i=this.status.browser.online;this.status.browser.online=navigator.onLine,navigator.connection&&(this.status.browser.type=navigator.connection.effectiveType||"unknown",this.status.browser.downlink=navigator.connection.downlink||null,this.status.browser.rtt=navigator.connection.rtt||null),i!==this.status.browser.online&&(this.status.browser.online?setTimeout(()=>this.checkBackendStatus(),1e3):this.updateBackendStatus(!1,null,"Network offline")),this.notifyListeners()};window.addEventListener("online",e),window.addEventListener("offline",e),navigator.connection&&(navigator.connection.addEventListener("change",e),e())}addListener(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}notifyListeners(){this.listeners.forEach(e=>{try{e(this.status)}catch(i){console.error("NetworkStatusService: Listener error:",i)}})}async checkBackendStatus(){if(this.isChecking)return this.status.backend.connected;this.isChecking=!0;const e=Date.now();try{const i=await Z.getHealthStatus(),a=Date.now()-e;return i&&i.code===200&&i.data?(this.updateBackendStatus(!0,a),this.updateSystemStatus(i.data),!0):(this.updateBackendStatus(!1,a,"Invalid response"),!1)}catch(i){const a=Date.now()-e;return this.updateBackendStatus(!1,a,i.message),!1}finally{this.isChecking=!1}}async checkSystemHealth(){try{const e=await Z.getSystemHealthStatus();return e&&e.code===200&&e.data?(this.updateSystemStatus(e.data),e.data):null}catch(e){return console.error("Failed to check system health:",e),this.updateSystemStatus(null,e.message),null}}updateBackendStatus(e,i=null,a=null){this.status.backend={connected:e,status:e?"healthy":"unhealthy",responseTime:i,lastCheck:new Date().toISOString(),error:a},this.notifyListeners()}updateSystemStatus(e,i=null){var a,f,u,m,b,l,g,_,h,y,p,c,s,r,T,k,A;e?this.status.system={server:{status:((a=e.server)==null?void 0:a.status)||"unknown",host:(f=e.server)==null?void 0:f.host,port:(u=e.server)==null?void 0:u.port,uptime:(m=e.server)==null?void 0:m.uptime},database:{status:((b=e.database)==null?void 0:b.status)||"unknown",connected:((l=e.database)==null?void 0:l.connected)||!1,host:(g=e.database)==null?void 0:g.host,port:(_=e.database)==null?void 0:_.port,database:(h=e.database)==null?void 0:h.database,responseTime:(y=e.database)==null?void 0:y.response_time_ms,error:(p=e.database)==null?void 0:p.error},cache:{status:((c=e.cache)==null?void 0:c.status)||"unknown",connected:((s=e.cache)==null?void 0:s.connected)||!1,host:(r=e.cache)==null?void 0:r.host,port:(T=e.cache)==null?void 0:T.port,responseTime:(k=e.cache)==null?void 0:k.response_time_ms,error:(A=e.cache)==null?void 0:A.error},overall:e.status||"unknown",version:e.version,timestamp:e.timestamp,error:null}:this.status.system={server:null,database:null,cache:null,overall:"unknown",error:i},this.notifyListeners()}startPeriodicCheck(e=3e4){this.stopPeriodicCheck(),this.checkBackendStatus(),this.checkInterval=setInterval(async()=>{this.status.browser.online&&await this.checkBackendStatus()},e)}stopPeriodicCheck(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}async refresh(){if(!this.status.browser.online){this.updateBackendStatus(!1,null,"Browser offline");return}await this.checkBackendStatus(),this.status.backend.connected&&await this.checkSystemHealth()}getStatus(){return{...this.status}}getOverallStatus(){return this.status.browser.online?!this.status.backend.connected||this.status.system.overall==="critical"?"degraded":"online":"offline"}getStatusText(){switch(this.getOverallStatus()){case"online":return{status:"在线",detail:"所有服务正常运行",color:"success"};case"degraded":return{status:"服务受限",detail:this.status.backend.connected?"部分服务异常":"后端服务连接失败",color:"warning"};case"offline":return{status:"离线",detail:"网络连接已断开",color:"danger"};default:return{status:"未知",detail:"状态检测中...",color:"default"}}}destroy(){this.stopPeriodicCheck(),this.listeners.clear(),window.removeEventListener("online",this.updateBrowserStatus),window.removeEventListener("offline",this.updateBrowserStatus),navigator.connection&&navigator.connection.removeEventListener("change",this.updateBrowserStatus)}}const F=new Gt;const qt={class:"network-status"},Yt={class:"status-details"},Xt={class:"status-section"},Kt={class:"section-header"},Wt={class:"status-item"},Qt={key:0,class:"status-item"},Jt={class:"status-value"},Zt={key:1,class:"status-item"},ea={class:"status-value"},ta={class:"status-section"},aa={class:"section-header"},sa={class:"status-item"},na={key:0,class:"status-item"},oa={class:"status-value"},ia={key:1,class:"status-item"},ra={class:"status-value status-error"},la={key:0,class:"status-section"},ca={class:"section-header"},ua={class:"status-subsection"},da={class:"subsection-title"},va={class:"status-item"},fa={class:"status-item"},ma={class:"status-value"},ga={key:0,class:"status-item"},ha={class:"status-value"},pa={key:1,class:"status-item"},ba={class:"status-value status-error"},_a={class:"status-subsection"},ya={class:"subsection-title"},wa={class:"status-item"},ka={class:"status-item"},Sa={class:"status-value"},xa={key:0,class:"status-item"},Ta={class:"status-value"},Ca={key:1,class:"status-item"},La={class:"status-value status-error"},$a={key:0,class:"status-item"},Pa={class:"status-value"},Ba={key:1,class:"status-item"},za={class:"status-value"},Ia={class:"status-actions"},Na={__name:"NetworkStatus",setup(t){const e=$(!1),i=$(!1),a=$(F.getStatus()),f=N(()=>F.getStatusText()),u=N(()=>{switch(F.getOverallStatus()){case"online":return"success";case"degraded":return"warning";case"offline":return"fail";default:return"question"}}),m=N(()=>{switch(F.getOverallStatus()){case"online":return"#07c160";case"degraded":return"#ff976a";case"offline":return"#ee0a24";default:return"#969799"}}),b=N(()=>a.value.backend.lastCheck?new Date(a.value.backend.lastCheck).toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}):"未检测");let l=null;function g(c){return{"slow-2g":"2G慢速","2g":"2G","3g":"3G","4g":"4G","5g":"5G",wifi:"WiFi"}[c]||c.toUpperCase()}function _(c){switch(c){case"healthy":return"status-success";case"unhealthy":return"status-error";case"degraded":return"status-warning";default:return"status-default"}}function h(c){switch(c){case"healthy":return"正常";case"unhealthy":return"异常";case"degraded":return"降级";default:return"未知"}}function y(c){return ze(new Date(c))}async function p(){i.value=!0;try{await F.refresh()}finally{i.value=!1}}return ve(()=>{l=F.addListener(c=>{a.value=c}),F.startPeriodicCheck()}),$e(()=>{l&&l()}),(c,s)=>{const r=fe,T=lt,k=_e,A=Pe,E=It;return x(),z("div",qt,[n(k,{title:f.value.status,label:f.value.detail,value:b.value,clickable:"",onClick:s[0]||(s[0]=d=>e.value=!e.value)},{icon:P(()=>[n(r,{name:u.value,color:m.value,class:"status-icon"},null,8,["name","color"])]),"right-icon":P(()=>[i.value?(x(),M(T,{key:0,size:"16"})):(x(),M(r,{key:1,name:"arrow-down",class:Q({"detail-arrow":!0,"detail-arrow-up":e.value})},null,8,["class"]))]),_:1},8,["title","label","value"]),e.value?(x(),M(E,{key:0,class:"detail-panel"},{default:P(()=>{var d,R,w,C,v,O,j,K,W,ae,se,ne;return[o("div",Yt,[o("div",Xt,[o("div",Kt,[n(r,{name:"phone",size:"16"}),s[1]||(s[1]=o("span",{class:"section-title"},"浏览器网络",-1))]),o("div",Wt,[s[2]||(s[2]=o("span",{class:"status-label"},"连接状态:",-1)),o("span",{class:Q(["status-value",a.value.browser.online?"status-success":"status-error"])},L(a.value.browser.online?"在线":"离线"),3)]),a.value.browser.type!=="unknown"?(x(),z("div",Qt,[s[3]||(s[3]=o("span",{class:"status-label"},"网络类型:",-1)),o("span",Jt,L(g(a.value.browser.type)),1)])):I("",!0),a.value.browser.downlink?(x(),z("div",Zt,[s[4]||(s[4]=o("span",{class:"status-label"},"下行速度:",-1)),o("span",ea,L(a.value.browser.downlink)+"Mbps",1)])):I("",!0)]),o("div",ta,[o("div",aa,[n(r,{name:"laptop",size:"16"}),s[5]||(s[5]=o("span",{class:"section-title"},"Rocket后端服务",-1))]),o("div",sa,[s[6]||(s[6]=o("span",{class:"status-label"},"连接状态:",-1)),o("span",{class:Q(["status-value",a.value.backend.connected?"status-success":"status-error"])},L(a.value.backend.connected?"已连接":"连接失败"),3)]),a.value.backend.responseTime?(x(),z("div",na,[s[7]||(s[7]=o("span",{class:"status-label"},"响应时间:",-1)),o("span",oa,L(a.value.backend.responseTime)+"ms",1)])):I("",!0),a.value.backend.error?(x(),z("div",ia,[s[8]||(s[8]=o("span",{class:"status-label"},"错误信息:",-1)),o("span",ra,L(a.value.backend.error),1)])):I("",!0)]),a.value.system.overall!=="unknown"?(x(),z("div",la,[o("div",ca,[n(r,{name:"setting",size:"16"}),s[9]||(s[9]=o("span",{class:"section-title"},"系统组件状态",-1))]),o("div",ua,[o("div",da,[n(r,{name:"records",size:"14"}),s[10]||(s[10]=D(" 数据库 (PostgreSQL) ",-1))]),o("div",va,[s[11]||(s[11]=o("span",{class:"status-label"},"状态:",-1)),o("span",{class:Q(["status-value",_((d=a.value.system.database)==null?void 0:d.status)])},L(h((R=a.value.system.database)==null?void 0:R.status)),3)]),o("div",fa,[s[12]||(s[12]=o("span",{class:"status-label"},"地址:",-1)),o("span",ma,L((w=a.value.system.database)==null?void 0:w.host)+":"+L((C=a.value.system.database)==null?void 0:C.port),1)]),(v=a.value.system.database)!=null&&v.responseTime?(x(),z("div",ga,[s[13]||(s[13]=o("span",{class:"status-label"},"响应时间:",-1)),o("span",ha,L(a.value.system.database.responseTime)+"ms",1)])):I("",!0),(O=a.value.system.database)!=null&&O.error?(x(),z("div",pa,[s[14]||(s[14]=o("span",{class:"status-label"},"错误:",-1)),o("span",ba,L(a.value.system.database.error),1)])):I("",!0)]),o("div",_a,[o("div",ya,[n(r,{name:"fire",size:"14"}),s[15]||(s[15]=D(" 缓存 (Redis) ",-1))]),o("div",wa,[s[16]||(s[16]=o("span",{class:"status-label"},"状态:",-1)),o("span",{class:Q(["status-value",_((j=a.value.system.cache)==null?void 0:j.status)])},L(h((K=a.value.system.cache)==null?void 0:K.status)),3)]),o("div",ka,[s[17]||(s[17]=o("span",{class:"status-label"},"地址:",-1)),o("span",Sa,L((W=a.value.system.cache)==null?void 0:W.host)+":"+L((ae=a.value.system.cache)==null?void 0:ae.port),1)]),(se=a.value.system.cache)!=null&&se.responseTime?(x(),z("div",xa,[s[18]||(s[18]=o("span",{class:"status-label"},"响应时间:",-1)),o("span",Ta,L(a.value.system.cache.responseTime)+"ms",1)])):I("",!0),(ne=a.value.system.cache)!=null&&ne.error?(x(),z("div",Ca,[s[19]||(s[19]=o("span",{class:"status-label"},"错误:",-1)),o("span",La,L(a.value.system.cache.error),1)])):I("",!0)]),a.value.system.version?(x(),z("div",$a,[s[20]||(s[20]=o("span",{class:"status-label"},"版本:",-1)),o("span",Pa,L(a.value.system.version),1)])):I("",!0),a.value.system.timestamp?(x(),z("div",Ba,[s[21]||(s[21]=o("span",{class:"status-label"},"更新时间:",-1)),o("span",za,L(y(a.value.system.timestamp)),1)])):I("",!0)])):I("",!0),o("div",Ia,[n(A,{type:"primary",size:"small",loading:i.value,onClick:p},{default:P(()=>[...s[22]||(s[22]=[D(" 刷新状态 ",-1)])]),_:1},8,["loading"])])])]}),_:1})):I("",!0)])}}},Aa=Ie(Na,[["__scopeId","data-v-04d1150c"]]);const Ea={class:"home-page"},Ra={class:"user-info-card"},Ua={class:"avatar"},Oa={class:"user-name"},Da={class:"user-role"},Va={class:"user-actions"},Fa={class:"function-menu"},Ma={class:"data-overview"},Ha={class:"system-status"},ja={__name:"Home",setup(t){const e=ct(),i=ut(),a=dt(),f=$([]),u=$(!1),m=$(!1),b=$(null),l=vt({name:"",description:"",data_type:"",content:""}),g=$("1.0.0"),_=N(()=>f.value.slice(0,3)),h=$([{id:"user-data",icon:"records",text:"我的数据",action:"viewAllUserData"},{id:"add-data",icon:"add-o",text:"添加数据",action:"showAddDataDialog"},{id:"profile",icon:"contact",text:"个人资料",action:"viewProfile"},{id:"settings",icon:"setting-o",text:"设置",action:"goToSettings"}]);function y(C){const v=C.action;if(typeof window[v]=="function")window[v]();else if(typeof this[v]=="function")this[v]();else switch(v){case"viewAllUserData":k();break;case"showAddDataDialog":E();break;case"viewProfile":s();break;case"goToSettings":c();break;default:console.warn("Unknown menu action:",v)}}function p(){a.platformAdapter.goBack()}function c(){a.smartNavigate("/settings")}function s(){a.smartNavigate("/profile")}async function r(){if(!e.isLoggedIn){console.log("User already logged out"),await a.smartNavigate("/login",{replace:!0});return}if((await a.platformAdapter.showConfirm("确认退出","确定要退出登录吗？","取消","确定")).confirm)try{await Z.mobileLogout()}catch(v){console.error("Logout failed:",v),v.message&&v.message.includes("401")&&console.log("Already logged out on server side"),e.clearUser(),await a.smartNavigate("/login",{replace:!0})}}async function T(){try{u.value=!0;const C=await Z.mobileGetUserData();C.data&&Array.isArray(C.data)&&(f.value=C.data)}catch(C){console.error("Failed to load user data:",C),await a.platformAdapter.showToast("加载数据失败","error")}finally{u.value=!1}}function k(){a.smartNavigate("/user-data")}function A(C){a.smartNavigate("/user-data",{query:{id:C.id}})}function E(){m.value=!0,Object.assign(l,{name:"",description:"",data_type:"",content:""})}async function d(){var C,v;try{if(!l.name||!l.data_type||!l.content){await a.platformAdapter.showToast("请填写完整信息","error");return}const O=await Z.mobileAddUserData({name:l.name.trim(),description:l.description.trim(),data_type:l.data_type.trim(),content:l.content.trim(),is_public:!1});await T(),m.value=!1,await a.platformAdapter.showToast("添加成功","success")}catch(O){console.error("Failed to add user data:",O);const j=((v=(C=O.response)==null?void 0:C.data)==null?void 0:v.message)||"添加失败";await a.platformAdapter.showToast(j,"error")}}function R(C){return{text:"primary",json:"success",image:"warning",file:"default"}[C]||"default"}async function w(){await a.platformAdapter.showToast("已是最新版本","success")}return ve(async()=>{const C=i.getAppInfo();g.value=C.version,await T(),await a.platformAdapter.setPageTitle(`首页 - ${e.getDisplayName()}`)}),$e(()=>{}),(C,v)=>{const O=mt,j=fe,K=Be,W=Pe,ae=Tt,se=jt,ne=Vt,oe=_e,ye=ht,Re=Rt,ie=gt,Ue=pt,Oe=ft;return x(),z("div",Ea,[n(O,{title:`欢迎，${J(e).getDisplayName()}`,"left-text":"返回","right-text":"设置","left-arrow":"",onClickLeft:p,onClickRight:c},null,8,["title"]),o("div",Ra,[n(ae,null,{thumb:P(()=>[o("div",Ua,[n(j,{name:"user-o",size:"40"})])]),title:P(()=>[o("div",Oa,L(J(e).username),1)]),desc:P(()=>[o("div",Da,[n(K,{type:J(e).isAdmin?"danger":"primary"},{default:P(()=>[D(L(J(e).isAdmin?"管理员":"普通用户"),1)]),_:1},8,["type"])])]),footer:P(()=>[o("div",Va,[n(W,{size:"mini",type:"primary",onClick:s},{default:P(()=>[...v[5]||(v[5]=[D(" 个人资料 ",-1)])]),_:1}),n(W,{size:"mini",plain:"",onClick:r},{default:P(()=>[...v[6]||(v[6]=[D(" 退出登录 ",-1)])]),_:1})])]),_:1})]),o("div",Fa,[n(ne,{"column-num":2,gutter:10},{default:P(()=>[(x(!0),z(he,null,ke(h.value,S=>(x(),M(se,{key:S.id,icon:S.icon,text:S.text,onClick:De=>y(S)},null,8,["icon","text","onClick"]))),128))]),_:1})]),o("div",Ma,[n(ye,{title:`我的数据 (${f.value.length})`},{default:P(()=>[(x(!0),z(he,null,ke(_.value,S=>(x(),M(oe,{key:S.id,title:S.name,label:S.description||"暂无描述",value:J(ze)(S.created_at),"is-link":"",onClick:De=>A(S)},{"right-icon":P(()=>[n(K,{size:"mini",type:R(S.data_type)},{default:P(()=>[D(L(S.data_type),1)]),_:2},1032,["type"])]),_:2},1032,["title","label","value","onClick"]))),128)),f.value.length===0?(x(),M(oe,{key:0,title:"暂无数据",label:"点击上方菜单添加您的第一条数据",center:""})):I("",!0),f.value.length>3?(x(),M(oe,{key:1,title:"查看全部",label:`还有 ${f.value.length-3} 条数据`,"is-link":"",onClick:k},null,8,["label"])):I("",!0)]),_:1},8,["title"])]),o("div",Ha,[n(ye,{title:"系统信息"},{default:P(()=>[n(Aa),n(oe,{title:"应用版本",value:g.value,label:"点击检查更新","is-link":"",onClick:w},null,8,["value"])]),_:1})]),n(Re,{axis:"xy",icon:"plus",magnetic:"x",onClick:E}),n(Oe,{show:m.value,"onUpdate:show":v[4]||(v[4]=S=>m.value=S),title:"添加数据","show-cancel-button":"",onConfirm:d},{default:P(()=>[n(Ue,{ref_key:"addForm",ref:b},{default:P(()=>[n(ie,{modelValue:l.name,"onUpdate:modelValue":v[0]||(v[0]=S=>l.name=S),label:"名称",placeholder:"请输入数据名称",rules:[{required:!0,message:"请填写数据名称"}]},null,8,["modelValue"]),n(ie,{modelValue:l.description,"onUpdate:modelValue":v[1]||(v[1]=S=>l.description=S),label:"描述",placeholder:"请输入数据描述（可选）"},null,8,["modelValue"]),n(ie,{modelValue:l.data_type,"onUpdate:modelValue":v[2]||(v[2]=S=>l.data_type=S),label:"类型",placeholder:"请输入数据类型",rules:[{required:!0,message:"请选择数据类型"}]},null,8,["modelValue"]),n(ie,{modelValue:l.content,"onUpdate:modelValue":v[3]||(v[3]=S=>l.content=S),type:"textarea",label:"内容",placeholder:"请输入数据内容",rules:[{required:!0,message:"请填写数据内容"}],rows:"3"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["show"])])}}},Ja=Ie(ja,[["__scopeId","data-v-c9eeb8ea"]]);export{Ja as default};
